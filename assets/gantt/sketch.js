!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.air=t():e.air=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Gantt:()=>v});const r=grender.extend(grender.Renderable,{_constructor:function(e){this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=+e.height||0,this.radius=6,this.completeOffset=0,this.borderColor,this.fillColor,this.name=e.name||""},updateComplete:function(e){this.completeOffset=e-this.x},draw:function(e){var t=this.x+4,r=this.y+4,n=this.width-8,i=this.height-8;this.path=new Path2D,this.path.rect(t,this.y,this.width,this.height);var a=this.radius,s=new Path2D;s.moveTo(t,r+a),s.arcTo(t,r,t+a,r,a),s.lineTo(t+n-a,r),s.arcTo(t+n,r,t+n,r+a,a),s.lineTo(t+n,this.y+i-a),s.arcTo(t+n,this.y+i,t+n-a,this.y+i,a),s.lineTo(t+a,this.y+i),s.arcTo(t,this.y+i,t,this.y+i-a,a),s.closePath(),this.completeOffset>this.width?(e.strokeStyle="hsl(150, 90%, 30%)",this.borderColor="hsl(150, 90%, 30%)"):(e.strokeStyle="hsl(204, 90%, 40%)",this.borderColor="hsl(204, 90%, 40%)"),e.lineWidth=4,e.stroke(s),e.fillStyle="hsl(204, 90%, 90%)",e.fill(s),e.save(),e.clip(s);var d="";this.completeOffset>this.width?(e.fillStyle="hsl(150, 70%, 50%)",this.fillColor="hsl(150, 70%, 50%)"):(e.fillStyle="hsl(204, 90%, 70%)",this.fillColor="hsl(204, 90%, 70%)",this.completeOffset>0&&(d="[".concat(Math.round(this.completeOffset/this.width*100),"%]"))),e.beginPath(),e.rect(this.x,this.y,this.completeOffset,this.height),e.fill(),e.restore(),e.save(),this.drawText(e,"".concat(this.name," ").concat(d),t+5,this.y+5,n-20,15),e.restore()},drawText:function(e,t,r,n,i,a){e.save();var s=t.split(""),d="",l=[],o=1.25*a;e.font="".concat(a,"px san-serif"),e.fillStyle="black",e.textAlign="left",e.textBaseline="middle";for(var c=0;c<s.length;c++)(e.measureText(d).width>i||"/"===s[c])&&(l.push(d),d=""),"/"!==s[c]&&(d+=s[c]);l.push(d);for(var h=0;h<l.length;h++)e.fillText(l[h],r,-o/4+n+(h+1)*o);e.restore()}}),n=grender.extend(grender.Renderable,{_constructor:function(e){this.x=e.x||0,this.y=e.y||0,this.size=10,this.color=e.color||"#111",this.dir=e.dir},draw:function(e){this.path=new Path2D,this.path.arc(this.x,this.y,this.size,0,2*Math.PI,!0),e.strokeStyle=this.color,e.fillStyle="#fff",e.lineWidth=window.devicePixelRatio,e.fill(this.path),e.stroke(this.path),e.save(),e.translate(this.x,this.y),e.beginPath(),"left"==this.dir?(e.moveTo(-this.size/1.6,0),e.lineTo(this.size/2.6,-this.size/1.8),e.lineTo(this.size/2.6,this.size/1.8)):"right"==this.dir&&(e.moveTo(this.size/1.6,0),e.lineTo(-this.size/2.6,this.size/1.8),e.lineTo(-this.size/2.6,-this.size/1.8)),e.closePath(),e.fillStyle=this.color,e.fill(),e.restore()}}),i=grender.extend(grender.Renderable,{_constructor:function(e){this.path=new Path2D,this.index=e.index||0,this.heightOfSingleTask=e.heightOfSingleTask,this.fillColor="hsla(0, 0%, 0%, .04)"},draw:function(e){this.path=new Path2D,this.path.rect(0,this.heightOfSingleTask*this.index,e.canvas.width,this.heightOfSingleTask);var t=new Path2D;t.rect(0,this.heightOfSingleTask*this.index,e.canvas.width,this.heightOfSingleTask-2),this.trackCount<1||(e.save(),e.fillStyle=this.fillColor,e.fill(t),e.restore())}}),a=grender.extend(grender.Renderable,{_constructor:function(e){this.path=new Path2D,this.date=e.date||{},this.fillColor=e.fillColor||"#f8f8f8",this.restColor=e.restColor||"#eee",this.pixelOfEveryBlock=e.pixelOfEveryBlock||0,this.index=e.index||0},draw:function(e){this.path=new Path2D,this.path.rect(this.pixelOfEveryBlock*this.index,0,this.pixelOfEveryBlock,e.canvas.height);var t=new Path2D;t.rect(this.pixelOfEveryBlock*this.index,0,this.pixelOfEveryBlock-window.devicePixelRatio,e.canvas.height),e.save(),e.fillStyle=this.fillColor,e.fill(t),e.restore()}}),s=grender.extend(grender.Renderable,{_constructor:function(e){this.x=e.x||0},draw:function(e){var t=new Path2D;t.moveTo(this.x,0),t.lineTo(this.x,e.canvas.height),e.save(),e.strokeStyle="hsl(0, 90%, 50%)",e.lineWidth=window.devicePixelRatio,e.stroke(t),e.restore()}});function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,i,a=[],s=!0,d=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){d=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(d)throw i}}return a}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=o(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){d=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(d)throw a}}}}function o(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e){return[e.getTime(),e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getDay()]}function f(e){switch(e){case 0:return"周日";case 1:return"周一";case 2:return"周二";case 3:return"周三";case 4:return"周四";case 5:return"周五";case 6:return"周六"}}function u(){return Math.random().toString(32).slice(2,-1)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,i,a=[],s=!0,d=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){d=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(d)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e){var t=function(e){var t={menuWidth:350,pixelOfEveryBlock:e["unit-width"]||function(){switch(e.planeType){case"day":case"week":return 40;case"month":return 70;case"year":return 30}}(),millisecondOfEveryBlock:function(){switch(e.planeType){case"day":return 6e5;case"week":return 216e5;case"month":return 432e5;case"year":return 1728e5}}(),heightOfSingleTask:e.height||40,heightOfDate:71,tracks:e.schedule.map((function(e){return{taskName:e.title,uid:u(),childrenUID:[],queue:e.queue.map((function(e){var t=u();return{uid:t,title:e.title||t,startTime:new Date(e.startTime),endTime:new Date(e.endTime)}}))}})),nowDate:new Date,getRandomStr:u,getTrackByUID:function(e){for(var t=null,r=0;r<this.tracks.length;r++)this.tracks[r].uid==e&&(t=this.tracks[r]);return t},updateAGHeight:function(e,t,r){e=e||0,t.setStyleSize(r.ganttWidth,e);for(var n=0;n<t.rendererManager.children.length;n++)t.rendererManager.children[n].setStyleSize(r.ganttWidth,e),t.rendererManager.children[n].setAttrSize(r.ganttWidth,e),t.rendererManager.children[n].reRender()},updateGridTasks:function(t,n){var a=this;if(n.tracks.length){for(var s=new Date(e.startTime),d=[],l=[],o=function(e){var o=n.tracks[e],c=new i({index:e,heightOfSingleTask:n.heightOfSingleTask});d.push(c),o.queue.forEach((function(i){var d=i.startTime,c=i.endTime,h=Math.round((d-s)/a.millisecondOfEveryBlock),f=Math.round((c-s)/a.millisecondOfEveryBlock-1),u=new r({x:h*a.pixelOfEveryBlock,y:e*n.heightOfSingleTask,width:(f-h+1)*a.pixelOfEveryBlock,height:n.heightOfSingleTask,name:i.title});u.userData={uid:i.uid,isCreated:!0,startGridDayIndex:h,endGridDayIndex:f,trackIndex:e,trackUID:o.uid},a.refreshTimeline(t,n),u.updateComplete(t.renderers.now.scene.children[0].x),l.push(u)}))},c=0;c<n.tracks.length;c++)o(c);t.renderers.gridTasks.scene.children=d,t.renderers.gridTasks.reRender(),t.renderers.bars.scene.children=l,t.renderers.bars.reRender()}},initGridDays:function(e,t){for(var r=[],n=0;n<t.timelineTicks.ticks.length;n++){var i=new a({date:t.timelineTicks.ticks[n],index:n,pixelOfEveryBlock:t.pixelOfEveryBlock});r.push(i)}e.renderers.gridDays.scene.children=r,e.renderers.gridDays.reRender()},refreshTimeline:function(t,r){var n=e.startTime,i=(e.endTime,new Date),a=(i-new Date(n))/this.millisecondOfEveryBlock*this.pixelOfEveryBlock,d=new s({x:a});t.renderers.now.scene.children=[d],t.renderers.now.reRender(),r.nowDate=i,t.renderers.bars.scene.children.forEach((function(e){e.updateComplete(a)})),t.renderers.bars.reRender()},initNowTimeLine:function(e,t){var r=this;this.refreshTimeline(e,t),setInterval((function(){r.refreshTimeline(e,t)}),5e3)},addTrack:function(e,t,r,n){e<0&&(e=0),n.tracks.splice(e,0,t)},deleteTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=n.tracks[e].uid;n.tracks.splice(e,t),r.renderers.bars.scene.children=r.renderers.bars.scene.children.filter((function(e){return e.userData.trackUID!==i})),n.tracks.forEach((function(e,t){var i=e.uid;r.renderers.bars.scene.children.forEach((function(e){e.userData.trackUID===i&&(e.userData.trackIndex=t,e.y=t*n.heightOfSingleTask)}))})),r.renderers.bars.reRender()},updateTaskName:function(e,t,r,n){n.tracks[e].taskName=t},getIndexByTaskEl:function(e,t){for(var r=-1,n=0;n<e.children.length;n++){if(r++,e.children[n]==t)return r;for(var i=e.children[n].children[1],a=0;a<i.children.length;a++)if(r++,i.children[a]==t)return r}},getBarsByTrackUID:function(e,t,r){return e.renderers.bars.scene.children.filter((function(e){return e.userData.trackUID===r}))},updateTaskList:function(t,r){var n=this,i=r.AppEl.getElementsByClassName("task-list")[0],a=+i.dataset.taskCount,s=+i.dataset.allTaskCount;s||(i.dataset.allTaskCount=s=r.tracks.length);for(var d=0;d<r.tracks.length;d++)r.tracks[d].childrenUID&&a++;i.dataset.taskCount=a;for(var l="",o=function(i){var a=r.tracks[i],s=n.getBarsByTrackUID(t,r,a.uid),d=[],o=0;s.forEach((function(t){var r=t.userData,i=r.startGridDayIndex,a=r.endGridDayIndex,s=r.uid;o+=(a-i+1)*n.millisecondOfEveryBlock;var l=new Date(e.startTime);d.push({startTime:new Date(l.getTime()+i*n.millisecondOfEveryBlock),endTime:new Date(l.getTime()+(a+1)*n.millisecondOfEveryBlock),uid:s,title:t.name})})),a.queue=d;var c="",h=0;switch(e.planeType){case"day":c="分钟",h=o/1e3/60;break;case"week":case"month":c="小时",h=o/1e3/60/60;break;case"year":c="日",h=o/1e3/60/60/24}l+='\n        <div>\n          <div style="font-size:16px;color:#333;background-color:#fff;text-align:center;height:'.concat(r.heightOfSingleTask,'px; display:flex;align-items: center;justify-content: center;z-index: 1;border-bottom:1px solid #ddd;padding-left:10px;">\n            <div style="cursor:pointer;width:300px;white-space:nowrap;text-align:left;overflow: hidden;text-overflow: ellipsis;" data-type="btn" data-click-func="editTaskName" data-is-editing>').concat(a.taskName,'</div>\n            <div style="color:#555;width:60px;text-align:center;">').concat(h,'<span style="font-size:12px;font-weight:normal;">').concat(c,'</span></div>\n            <div class="airglass-fui-gantt-operate">\n              <svg style="display:block;" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M426.666667 810.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z m0-298.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z m0-298.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z" fill="#009bff"></path></svg>\n              <div style="background-color: #fff;">\n                <div data-type="btn" data-click-func="deleteTask" style="padding: 0 5px;cursor:pointer;" title="删除任务"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="display:block;"><path d="M512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z m0-85.333334a341.333333 341.333333 0 1 0 0-682.666666 341.333333 341.333333 0 0 0 0 682.666666z m-192-384h384v85.333334h-384v-85.333334z" fill="#009bff"></path></svg></div>\n              </div>\n            </div>\n          </div>\n          <div class="task-list" style="" data-task-count="').concat(a.childrenUID.length,'">'),l+="\n          </div>\n        </div>"},c=0;c<r.tracks.length;c++)o(c);i.innerHTML=l},editQueueTaskName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return window.prompt("请编辑队列任务名称",e)},toJSON:function(){var r=e.startTime,n=e.endTime,i=e.planeType;return{title:e.title||"","unit-width":e["unit-width"]||"",startTime:r,endTime:n,planeType:i,height:e.height||this.heightOfSingleTask,schedule:t.tracks.map((function(e){return{title:e.taskName,queue:e.queue.map((function(e){return t={title:"",startTime:e.startTime.toLocaleString(),endTime:e.endTime.toLocaleString()},r="title",n=e.title||e.uid,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t;var t,r,n}))}}))}}};return t.timelineTicks=function(e){for(var t=e.endTime,r=e.type,n=e.millisecondOfEveryTicks,i=new Date(e.startTime),a=(new Date(t)-i)/n,s=[h(i)],o=0;o<a;o++)i.setMilliseconds(n),s.push(h(i));var c={ticks:[],timeFormats:[]};switch(r){case"day":var u,p=l(s);try{for(p.s();!(u=p.n()).done;){var g=d(u.value,6),v=g[0],y=g[1],m=g[2],k=g[3],x=g[4],w=g[5],T="".concat(y,"/").concat(m,"/").concat(k," ").concat(x,"时");c.ticks.push(new Date(v)),c.timeFormats[T]?c.timeFormats[T].push(["".concat(w,"分"),v]):c.timeFormats[T]=[["".concat(w,"分"),v]]}}catch(e){p.e(e)}finally{p.f()}break;case"week":var b,D=l(s);try{for(D.s();!(b=D.n()).done;){var O=d(b.value,7),S=O[0],E=O[1],C=O[2],I=O[3],B=O[4],z=(O[5],f(O[6])),N="".concat(E,"/").concat(C,"/").concat(I," ").concat(z);c.ticks.push(new Date(S)),c.timeFormats[N]?c.timeFormats[N].push(["".concat(B,"点"),S]):c.timeFormats[N]=[["".concat(B,"点"),S]]}}catch(e){D.e(e)}finally{D.f()}break;case"month":var L,M=l(s);try{for(M.s();!(L=M.n()).done;){var G=d(L.value,7),P=G[0],R=G[1],A=G[2],j=G[3],F=G[4],U=(G[5],f(G[6])),H="".concat(R,"/").concat(A,"/").concat(j," ").concat(U);c.ticks.push(new Date(P)),c.timeFormats[H]?c.timeFormats[H].push(["".concat(F,"点"),P]):c.timeFormats[H]=[["".concat(F,"点"),P]]}}catch(e){M.e(e)}finally{M.f()}break;case"year":var W,q=l(s);try{for(q.s();!(W=q.n()).done;){var _=d(W.value,7),V=_[0],J=_[1],Q=_[2],Z=_[3],$=(_[4],_[5],_[6],"".concat(J,"年").concat(Q,"月"));c.ticks.push(new Date(V)),c.timeFormats[$]?c.timeFormats[$].push(["".concat(Z,"日"),V]):c.timeFormats[$]=[["".concat(Z,"日"),V]]}}catch(e){q.e(e)}finally{q.f()}}for(var Y in c.timeFormats)c.timeFormats[Y].length<=1&&(delete c.timeFormats[Y],c.ticks.pop());return c}({startTime:e.startTime,endTime:e.endTime,type:e.planeType,millisecondOfEveryTicks:t.millisecondOfEveryBlock}),t.ganttWidth=t.timelineTicks.ticks.length*t.pixelOfEveryBlock+20,t}(e.project),o=document.createElement("div");t.AppEl=o,o.classList.add("airglass-gantt-app-el"),o.style="font-size:14px;color:#555;overflow-y:auto;padding-bottom: 20px;padding-left:".concat(t.menuWidth,"px;height:100%;"),e.el.appendChild(o),t.onSave=e.onSave||function(){},t.onPrint=e.onPrint||function(){};var c=document.createElement("div");c.classList.add("airglass-gantt-menu"),c.style="position:absolute; top:0; left:0; width:".concat(t.menuWidth,"px;box-shadow:rgba(0, 0, 0, 0.2) -1px -6px 20px 0px;z-index:1;"),t.AppEl.appendChild(c);var g='\n  <div style="height:'.concat(t.heightOfDate,'px;text-align:center;display: flex;align-items: center;justify-content: center;border: 1px solid #ddd;background-color:#fff;">\n    <div data-type="btn" data-click-func="createTask" style="cursor:pointer;display:flex;align-items: center;justify-content:center; padding:8px 10px; background-color:#009bff;color:#fff; border-radius:17px; margin:10px 5px;"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" style=""><path d="M512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z m0-85.333334a341.333333 341.333333 0 1 0 0-682.666666 341.333333 341.333333 0 0 0 0 682.666666z m-42.666667-384V320h85.333334V469.333333h149.333333v85.333334H554.666667v149.333333h-85.333334V554.666667H320v-85.333334H469.333333z" fill="#fff"></path></svg>&nbsp;新系列</div>\n    <div data-type="btn" data-click-func="printProject" style="cursor:pointer;display:flex;align-items: center;justify-content:center; padding:8px 10px; background-color:#009bff;color:#fff; border-radius:17px; margin:10px 5px;"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M309.432889 696.952889" fill="#fff"></path><path d="M717.738667 415.274667m-22.648889 0a3.185 3.185 0 1 0 45.297778 0 3.185 3.185 0 1 0-45.297778 0Z" fill="#fff"></path><path d="M781.880889 302.250667l-20.16 0L761.720889 194.552889c0-39.210667-31.900444-71.111111-71.111111-71.111111L352.099556 123.441778c-39.210667 0-71.111111 31.900444-71.111111 71.111111l0 107.697778-38.869333 0c-54.897778 0-99.555556 44.657778-99.555556 99.555556L142.563556 625.848889c0 54.897778 43.804444 99.555556 97.649778 99.555556l40.768 0 0 118.264889c0 39.210667 31.900444 71.111111 71.111111 71.111111l338.510222 0c39.210667 0 71.111111-31.900444 71.111111-71.111111L761.713778 725.404444l31.409778 0c48.696889 0 88.305778-44.657778 88.305778-99.555556L881.429333 401.806222C881.436444 346.908444 836.778667 302.250667 781.880889 302.250667zM337.877333 194.552889c0-7.708444 6.513778-14.222222 14.222222-14.222222l338.510222 0c7.708444 0 14.222222 6.513778 14.222222 14.222222l0 107.697778L337.877333 302.250667 337.877333 194.552889zM704.832 843.669333c0 7.708444-6.513778 14.222222-14.222222 14.222222L352.099556 857.891556c-7.708444 0-14.222222-6.513778-14.222222-14.222222L337.877333 579.569778c0-7.708444 6.513778-14.222222 14.222222-14.222222l338.510222 0c7.708444 0 14.222222 6.513778 14.222222 14.222222L704.832 843.669333zM824.547556 625.848889c0 23.125333-14.385778 42.666667-31.416889 42.666667l-31.409778 0L761.720889 579.569778c0-39.210667-31.900444-71.111111-71.111111-71.111111L352.099556 508.458667c-39.210667 0-71.111111 31.900444-71.111111 71.111111L280.988444 668.515556l-40.768 0c-22.478222 0-40.760889-19.136-40.760889-42.666667L199.459556 401.806222c0-23.530667 19.136-42.666667 42.666667-42.666667l539.754667 0c23.530667 0 42.666667 19.136 42.666667 42.666667L824.547556 625.848889z" fill="#fff"></path><path d="M626.083556 685.340444 405.589333 685.340444c-11.783111 0-21.333333-9.550222-21.333333-21.333333s9.550222-21.333333 21.333333-21.333333l220.494222 0c11.783111 0 21.333333 9.550222 21.333333 21.333333S637.866667 685.340444 626.083556 685.340444z" fill="#fff"></path><path d="M626.083556 787.612444 405.589333 787.612444c-11.783111 0-21.333333-9.550222-21.333333-21.333333s9.550222-21.333333 21.333333-21.333333l220.494222 0c11.783111 0 21.333333 9.550222 21.333333 21.333333S637.866667 787.612444 626.083556 787.612444z" fill="#fff"></path></svg>&nbsp;打印</div>\n    <div data-type="btn" data-click-func="saveProject" style="cursor:pointer;display:flex;align-items: center;justify-content:center; padding:8px 10px; background-color:#009bff;color:#fff; border-radius:17px; margin:10px 5px;"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3098" width="20" height="20"><path d="M773.696 134.812444l-509.155556 0c-69.76 0-126.520889 56.760889-126.520889 126.542222l0 501.326222c0 69.781333 56.760889 126.499556 126.520889 126.499556l509.141333 0c69.781333 0 126.520889-56.718222 126.520889-126.499556L900.202667 261.361778C900.202667 191.573333 843.441778 134.833778 773.696 134.812444zM324.437333 184.213333l389.347556 0 0 279.608889L324.437333 463.822222 324.437333 184.213333zM850.872889 762.680889c0 42.552889-34.616889 77.191111-77.169778 77.191111l-509.155556 0c-42.552889 0-77.169778-34.638222-77.169778-77.191111L187.377778 261.383111c0-42.574222 34.616889-77.169778 77.169778-77.169778l0-0.021333 10.567111 0 0 329.009778 488.007111 0 0.021333 0L763.143111 184.184889l10.567111 0c42.56 0 77.169778 34.595556 77.169778 77.169778L850.88 762.680889zM591.772444 256.832l49.329778 0 0 164.522667-49.329778 0 0-164.522667ZM591.772444 256.832" fill="#fff"></path></svg>&nbsp;导出</div>\n  </div>\n  <div class="task-list" style="border-right: 1px solid #ddd;" data-task-count data-all-task-count></div>');c.innerHTML=g;var v=document.createElement("div");v.classList.add("airglass-gantt-scrolling-wrap"),v.style="position: relative;width: 100%;overflow:auto;",t.AppEl.appendChild(v);var y=document.createElement("div");y.classList.add("airglass-gantt-date"),y.style="font-size:12px;overflow:hidden;text-align:center;height:".concat(t.heightOfDate,"px;width:").concat(t.ganttWidth,"px;"),v.appendChild(y),t.formatDate={};var m='<div style="overflow: hidden;border-top: 1px solid #eee;">';for(var k in t.timelineTicks.timeFormats){for(var x in m+='<div style="float:left;">\n        <div style="font-size:12px;border-bottom:1px solid #eee;line-height:3.8;border-right: 1px solid #eee;">'.concat(k,'</div>\n        <div style="">'),t.timelineTicks.timeFormats[k]){var w=p(t.timelineTicks.timeFormats[k][x],1)[0];m+='<div style="line-height:2;border-right:1px solid #eee;font-size:12px;float:left;width:'.concat(t.pixelOfEveryBlock,'px;"><div style="transform: translate(-50%, 0);background-color: #fff;">').concat(w,"</div></div>")}m+="</div></div>"}m+="</div>",y.innerHTML=m;var T=document.createElement("div");v.appendChild(T),T.classList.add("airglass-gantt-main");var b=new grender.Grender({element:T,width:t.ganttWidth,height:1,DPR:1});b.renderers={gridDays:b.addRenderer("gridDays"),gridTasks:b.addRenderer("gridTasks"),activeGrid:b.addRenderer("activeGrid"),bars:b.addRenderer("bars"),drag:b.addRenderer("drag"),now:b.addRenderer("now")},t.initGridDays(b,t),t.updateGridTasks(b,t),t.initNowTimeLine(b,t),t.updateTaskList(b,t),t.updateAGHeight(t.tracks.length*t.heightOfSingleTask,b,t),function(e,t){var i=[];i.push((function(){var n,i,a,s,d=!1,l=!1;return function(o,c){if("touchstart"==o.type&&(n=t.renderers.gridDays.getElementsContainPoint(o)[0],i=t.renderers.gridTasks.getElementsContainPoint(o)[0],e.tracks[i.index],t.renderers.bars.getElementsContainPoint(o)[0]||((a=new r({x:n.index*n.pixelOfEveryBlock,y:i.index*i.heightOfSingleTask,width:n.pixelOfEveryBlock,height:i.heightOfSingleTask,name:e.getRandomStr()})).updateComplete(t.renderers.now.scene.children[0].x),a.userData={uid:e.getRandomStr(),isCreated:!1,startGridDayIndex:n.index,endGridDayIndex:n.index,trackIndex:i.index,trackUID:e.tracks[i.index].uid},t.renderers.bars.scene.add(a),t.renderers.bars.reRender(),e.updateTaskList(t,e),s=n)),"touchmove"==o.type&&!l){var h=t.renderers.gridDays.getElementsContainPoint(o)[0];if(a&&h){if(h.index>=a.userData.startGridDayIndex)a.width=(h.index-a.userData.startGridDayIndex+1)*h.pixelOfEveryBlock,a.userData.endGridDayIndex=h.index;else for(var f=0;f<t.renderers.bars.scene.children.length;f++)t.renderers.bars.scene.children[f]==a&&(a=null,t.renderers.bars.scene.children.splice(f,1),l=!0);d=!0,s.index!=h.index&&(t.renderers.bars.reRender(),e.updateTaskList(t,e),s=h)}}"touchend"==o.type&&(a&&(a.userData.isCreated=!0,d||e.updateTaskList(t,e)),a=null,n=null,i=null,d=!1,s=null,l=!1)}})),i.push((function(){var r,n,i,a,s;return function(d,l){if("touchstart"==d.type){a=r=t.renderers.gridDays.getElementsContainPoint(d)[0],t.renderers.gridTasks.getElementsContainPoint(d)[0];var o=t.renderers.drag.getElementsContainPoint(d);(s=o[o.length-1])||(n=t.renderers.bars.getElementsContainPoint(d)[0])&&n.userData.isCreated&&(i=n.userData.startGridDayIndex)}if("touchmove"==d.type)e:if(n&&n.userData.isCreated){var c=t.renderers.gridDays.getElementsContainPoint(d)[0];if(c&&r&&null!==i&&a.index!=c.index){var h=i+c.index-r.index,f=h+(n.userData.endGridDayIndex-n.userData.startGridDayIndex),u=t.renderers.gridDays.scene.children[h],p=t.renderers.gridDays.scene.children[f];if(!u)break e;if(!p)break e;n.userData.startGridDayIndex=h,n.userData.endGridDayIndex=f,n.x=n.userData.startGridDayIndex*r.pixelOfEveryBlock,n.updateComplete(t.renderers.now.scene.children[0].x),t.renderers.bars.reRender(),e.updateTaskList(t,e),a=c,t.renderers.drag.reRender()}}if("touchmove"==d.type)e:if(s){var g=t.renderers.gridDays.getElementsContainPoint(d)[0];if(g&&r&&a.index!=g.index){if("start"==s.userData.type){var v=s.userData.bar,y=g,m=t.renderers.gridDays.scene.children[v.userData.endGridDayIndex];if(y.index>v.userData.endGridDayIndex)break e;v.x=y.index*e.pixelOfEveryBlock,v.width=(m.index-g.index+1)*e.pixelOfEveryBlock,v.userData.startGridDayIndex=y.index,v.updateComplete(t.renderers.now.scene.children[0].x),t.renderers.bars.reRender(),e.updateTaskList(t,e),s.x=v.userData.startGridDayIndex*e.pixelOfEveryBlock+e.pixelOfEveryBlock/2,t.renderers.drag.reRender()}if("end"==s.userData.type){var k=s.userData.bar,x=t.renderers.gridDays.scene.children[k.userData.startGridDayIndex],w=g;if(x.index>w.index)break e;k.width=(g.index-x.index+1)*e.pixelOfEveryBlock,k.userData.endGridDayIndex=g.index,k.updateComplete(t.renderers.now.scene.children[0].x),t.renderers.bars.reRender(),e.updateTaskList(t,e),s.x=k.userData.endGridDayIndex*e.pixelOfEveryBlock+e.pixelOfEveryBlock/2,t.renderers.drag.reRender()}a=g}}if("touchend"==d.type){if(n){var T=n.name,b=e.editQueueTaskName(T);n.name=b||T,t.renderers.bars.reRender(),e.updateTaskList(t,e)}n=null,r=null,i=null,a=null,s=null}}})),i.push((function(){return function(r,i){if("mousemove"==r.type||"touchmove"==r.type){var a=t.renderers.bars.getElementsContainPoint(r)[0];if(a){var s=parseInt(.2*a.height),d=new n({x:a.userData.startGridDayIndex*e.pixelOfEveryBlock+e.pixelOfEveryBlock/2,y:a.userData.trackIndex*e.heightOfSingleTask+e.heightOfSingleTask/2,size:s,color:a.borderColor,dir:"left"});d.userData={type:"start",bar:a};var l=new n({x:a.userData.endGridDayIndex*e.pixelOfEveryBlock+e.pixelOfEveryBlock/2,y:a.userData.trackIndex*e.heightOfSingleTask+e.heightOfSingleTask/2,size:s,color:a.borderColor,dir:"right"});l.userData={type:"end",bar:a},t.renderers.drag.scene.children=[d,l]}else t.renderers.drag.scene.children=[];t.renderers.drag.reRender()}"mouseout"==r.type&&(t.renderers.drag.scene.children=[],t.renderers.drag.reRender())}})),i.forEach((function(e){t.subscribe(e())}))}(t,b),function(e,t){var r={createTask:function(r,n){var i=e.getRandomStr(),a=i,s=r.parentNode.parentNode.getElementsByClassName("task-list")[0],d=+s.dataset.taskCount,l=+s.dataset.allTaskCount;return s.innerHTML+='<div>\n        <div style="font-size:16px;color:#333;background-color:#fff;text-align:center;height:'.concat(e.heightOfSingleTask,'px; display:flex;align-items: center;justify-content: center;z-index: 1;border-bottom:1px solid #ddd;padding-left:10px;">\n          <div style="cursor:pointer;width:300px;white-space:nowrap;text-align:left;overflow: hidden;text-overflow: ellipsis;" data-type="btn" data-click-func="editTaskName" data-is-editing>').concat(a,'</div>\n          <div style="color:#555;width:60px;text-align:center;">0<span style="font-size:12px;font-weight:normal;"></span></div>\n          <div class="airglass-fui-gantt-operate">\n            <svg style="display:block;" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M426.666667 810.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z m0-298.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z m0-298.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z" fill="#009bff"></path></svg>\n            <div style="background-color: #fff;">\n              <div data-type="btn" data-click-func="deleteTask" style="padding: 0 5px;cursor:pointer;" title="删除任务"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="display:block;"><path d="M512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z m0-85.333334a341.333333 341.333333 0 1 0 0-682.666666 341.333333 341.333333 0 0 0 0 682.666666z m-192-384h384v85.333334h-384v-85.333334z" fill="#009bff"></path></svg></div>\n            </div>\n          </div>\n        </div>\n        <div class="task-list" style="" data-task-count></div>\n      </div>'),e.addTrack(e.tracks.length,{uid:i,taskName:a,childrenUID:[],queue:[]},t,e),s.dataset.taskCount=d+1,s.dataset.allTaskCount=l+1,e.updateAGHeight((l+1)*e.heightOfSingleTask,t,e),e.updateGridTasks(t,e),!1},deleteTask:function(r,n){var i=r.parentNode.parentNode.parentNode.parentNode,a=i.parentNode,s=+i.getElementsByClassName("task-list")[0].dataset.taskCount;e.deleteTrack(e.getIndexByTaskEl(a,i),s+1,t,e),a.removeChild(i);var d=+a.dataset.taskCount,l=+a.dataset.allTaskCount;return a.dataset.taskCount=d-1,a.dataset.allTaskCount=l-1-s,e.updateAGHeight((l-1-s)*e.heightOfSingleTask,t,e),e.updateGridTasks(t,e),!1},createSubTask:function(r,n){var i=e.getRandomStr(),a="随机任务："+i,s=r.parentNode.parentNode.parentNode.parentNode,d=r.parentNode.parentNode.parentNode.parentNode.getElementsByClassName("task-list")[0],l=d.parentNode.parentNode,o=+d.dataset.taskCount,c=+l.dataset.allTaskCount;d.innerHTML+='<div style="font-size:14px;color:#555;border-bottom:1px solid #d4e3ec;background-color:#f0f8ff;height:'.concat(e.heightOfSingleTask,'px;">\n        <div style="height:').concat(e.heightOfSingleTask,'px;text-align:center;display:flex;align-items: center;justify-content: center;padding-left: 10px;">\n          <div style="width:180px;white-space: nowrap;text-align:left;overflow: hidden;text-overflow: ellipsis;" data-type="btn" data-click-func="editTaskName" data-is-editing>').concat(a,'</div>\n          <div style="color:#555;width:60px;text-align:center;">').concat(0,'<span style="font-size:12px;font-weight:normal;">分钟</span></div>\n          <div class="airglass-fui-gantt-operate">\n            <svg style="display:block;" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M426.666667 810.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z m0-298.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z m0-298.666667a85.333333 85.333333 0 1 1 170.666666 0 85.333333 85.333333 0 0 1-170.666666 0z" fill="#009bff"></path></svg>\n            <div style="background-color: #f0f8ff;">\n              <div data-type="btn" data-click-func="deleteSubTask" style="padding:0 5px;cursor:pointer;" title="删除任务"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="display:block;"><path d="M512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z m0-85.333334a341.333333 341.333333 0 1 0 0-682.666666 341.333333 341.333333 0 0 0 0 682.666666z m-192-384h384v85.333334h-384v-85.333334z" fill="#009bff"></path></svg></div>\n            </div>\n          </div>\n        </div>\n      </div>');var h=e.getIndexByTaskEl(l,s);e.tracks[h].childrenUID.push(i);var f=d.children[d.children.length-1];return e.addTrack(e.getIndexByTaskEl(l,f),{uid:i,taskName:a},t,e),d.dataset.taskCount=o+1,l.dataset.allTaskCount=c+1,e.updateAGHeight((c+1)*e.heightOfSingleTask,t,e),e.updateGridTasks(t,e),!1},deleteSubTask:function(r,n){for(var i=r.parentNode.parentNode.parentNode.parentNode,a=i.parentNode,s=a.parentNode.parentNode,d=+a.dataset.taskCount,l=+s.dataset.allTaskCount,o=e.getIndexByTaskEl(s,a.parentNode),c=e.getIndexByTaskEl(s,i),h=0;h<e.tracks[o].childrenUID.length;h++)e.tracks[o].childrenUID[h]==e.tracks[c].uid&&e.tracks[o].childrenUID.splice(h,1);return e.deleteTrack(c,1,t,e),a.removeChild(i),a.dataset.taskCount=d-1,s.dataset.allTaskCount=l-1,e.updateAGHeight((l-1)*e.heightOfSingleTask,t,e),e.updateGridTasks(t,e),!1},editTaskName:function(r,n){var i=r.innerText,a=window.prompt("请编辑任务名称",r.innerText)||i,s=e.AppEl.getElementsByClassName("task-list")[0],d=r.parentNode.parentNode,l=e.getIndexByTaskEl(s,d);e.updateTaskName(l,a,t,e),r.innerText=a},printProject:function(r,n){var i=document.createElement("canvas"),a=i.getContext("2d");i.width=t.renderers.bars.element.width,i.height=t.renderers.bars.element.height,a.fillStyle="#fff",a.fillRect(0,0,i.width,i.height),a.drawImage(t.renderers.gridDays.element,0,0),a.drawImage(t.renderers.gridTasks.element,0,0),a.drawImage(t.renderers.bars.element,0,0),t.renderers.now&&a.drawImage(t.renderers.now.element,0,0);var s=document.createElement("a");s.setAttribute("href",i.toDataURL()),s.setAttribute("download",Date.now()+".png"),s.click();var d=new Image;e.onPrint(d)},saveProject:function(t,r){e.onSave(e.toJSON())}};return function(e){e.addEventListener("click",(function(e){for(var t=e.target;this!==t;){if(!t)return;var n=t.dataset.type,i=t.dataset.clickFunc;if("btn"==n&&i&&r[i]&&!1===r[i](t,e))break;t=t.parentNode}}))}}(t,b)(t.AppEl);var D=p(b.renderers.now.scene.children,1)[0];if(D.x>0||v.scrollWidth>D.x){var O=Math.round(D.x),S=window.innerWidth-t.menuWidth;v.scrollLeft=O-Math.round(S/2)}return{version:"1.0.0",author:"shuaihuajun<lanserdi@163.com>",destroy:function(){}}}return t})()}));